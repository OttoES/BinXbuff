# BXB definition document
### GGCommsDefinition version 1.0-1
___
## Intoduction
This is the definiton of the message protocol                   used between the seat units and the master streamer
___
___
## Enumerations
___
### Enum cmd_t
 A list of all the commands. Note that all commands are send to a spesific     address except the broadcast command. Most commands have an acknowladge    but note:    
 * each command have a paired acknowldge command id    
 * there is oly onenot acknowladge command shared by all commands     
 * the debug command is not acknowladged    
 * a broadcast command is only acknowladced by one address

|Tag|Value|Comment|
|------|-----|------------------------------|
|CMD_BROADCAST|0x0A|  Broadcast |
|CMD_BROADCAST_ACK|0x03|  An acknowladge if the broadcast command was sucessfull |
|CMD_READ|0x15||
|CMD_READ_ACK|0x16||
|CMD_WRITE|0x29||
|CMD_WRITE_ACK|0x30|  Acknowladge send on a write|
|CMD_WR_SLAVE|0x3D|  Not used: Reserved to be used to write to a single seat unit.|
|CMD_DEBUG|0x1A|  Debug command only and should be ignored otherwise.|
|CMD_NACK|0x04|  A negative ackowladge used if any command failed  |
|CMD_ACK_HEADER|0x05|  An acknowladge used if the header was recieved withhout error.  |
### Enum Gender

|Tag|Value|Comment|
|------|-----|------------------------------|
|UNKNOWN|0||
|MALE|1|  set as male|
|FEMLE|0x2|  set as female|
|OTHER|0x3|  if a person identifies with a different gender |
### Enum ename

|Tag|Value|Comment|
|------|-----|------------------------------|
|x1|1||
|x2|2||
|a1|3||
___
___
## Structures
___
### MsgHeader
   This is the common header for all messages.
Fields in this structure


|Field|Type|Array|Comment|
|------|-----|-----|------------------------------|
|magic|uint32|-| This is a magic number that indicates the start of the message.   This is the same as 0x900DBEEF in bigendian format|
|destAddr|uint8|-|        The destination address is where the message should be send to.        Devices are allocated a fixed address. The address for the master streamer         is always 0. Seat units are each configured with ther own addresses.        Messages can be either directed to a single device or broadcasted         depending on the command. If it is a broadcast command the destination        will still be for a spesific address and that address should send CMD_BROADCAST_ACK        acknowladges or a CMD_ACK_HEADER on sucess or a CMD_NACK on an error.         When broadcasted the broadcast address      |
|sourceAddr|uint8|-|  The source address.|
|cmd|enum8 [cmd_t](#enum-cmd_t)|-|  This is the message identifier. |
|Total| length|7|4+1+1+1|
### ReadMsg
   The read command reads information from the seat units, normally statistics    and state changes. The seat unit should respond with a CMD_READ_ACK or    CMD_NAC on failure.


Structure local values
* CMD_ID  =  x66
* CMD_READ  =  6


Structure inherits all fields from **MsgHeader** and add these


|Field|Type|Array|Comment|
|------|-----|-----|------------------------------|
|Parent|[MsgHeader](#msgheader)||This data prepend this structure|
|subCmd|enum8 [read_t](#enum-read_t)|-|  |
|len|uint16|-|  no data send with this message|
|seqNr|uint16|-|       A sequence number assosiated with this message and returned        by the CMD_READ_ACK     |
|crc16|CRC16|-|  crc use for integrity checking|
|Total| length|14|4+1+1+1+ 1+2+2+2|
### SetProfile
   This is the message to set the user profile.   Line 2 of comment


Structure local values
* MSG_ID  =  0x1155
* ARRLEN  =  10


Structure inherits all fields from **MsgHeader** and add these


|Field|Type|Array|Comment|
|------|-----|-----|------------------------------|
|Parent|[MsgHeader](#msgheader)||This data prepend this structure|
|id|int32|-|  the user identificatin number|
|surname|char|20|  the user surname|
|fieldvarname|enum8 [ename](#enum-ename)|-||
|gender|enum8 [Gender](#enum-gender)|-||
|dlen|int8|-||
|hdrCrc2|CRC16|-|  a message calculated crc|
|addit|char|dlen||
|email|zstring|-||
|Total| length|variable|4+1+1+1+ 4+ (20)*1+1+1+1+2+ (dlen)*1+-100000|